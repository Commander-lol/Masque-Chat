import React, { Component, PropTypes } from 'react';
import { flatten } from 'lodash';
import ChatItem from './ChatItem';

export default class FacebookList extends Component {

  static propTypes = {
    loggedIn: PropTypes.bool.isRequired,
    fapi: PropTypes.object,
    users: PropTypes.object,
    threads: PropTypes.array,
    threadsById: PropTypes.object,
  }

  state = {
    threads: [],
  }

  componentDidMount = async () => {
    if (this.props.loggedIn) this.setState({ threads: await this.props.fapi.getThreadList(0, 5) });
  }

  componentWillReceiveProps(props) {
    if (props.fapi != null) {
      if (props.threads.length === 0) {
        props.loadThreads(0, 5, props.fapi);
      } else {
        const ids = flatten(props.threads.map(t => t.participantIDs));
        const idset = new Set(ids);
        const unloaded = [];
        Array.from(idset).forEach(id => {
          if (!props.users.hasOwnProperty(id)) {
            unloaded.push(id);
          }
        });
        if (unloaded.length > 0) {
          props.loadUsers(unloaded, props.fapi);
        }
      }
    }
  }

  mapThreadData = (thread) => {
    const data = {
      src: thread,
      id: thread.threadID,
    }

    console.log(thread);

    if (thread.participantIDs.length === 2) {
      const user = this.props.users[thread.participantIDs[0]];
      if (user == null) {
        this.props.loadUsers(thread.participantIDs[0], this.props.fapi);
        data.name = 'Loading...';
        data.img = 'data:image/png;base64,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'
      } else {
        data.name = user.name;
        data.img = user.thumbSrc;
      }
    } else {
      data.name = thread.name;
      data.img = thread.imageSrc;
    }

    if (thread.snippet !== '') {
      data.snippet = thread.snippet;
    } else {
      data.snippet = `${this.props.users[thread.snippetSender].firstName} sent a ${thread.snippetAttachments[0].attach_type}`;
    }

    return data;
  }

  render() {
    return (
      <div>
        <button onClick={async () => this.setState({ threads: await this.props.fapi.getThreadList(0, 5) })}>Refresh</button>
        {this.state.threads.map(this.mapThreadData).map(thread => (
          <ChatItem key={thread.id} {...thread} />
        ))}
      </div>
    );
  }
}
